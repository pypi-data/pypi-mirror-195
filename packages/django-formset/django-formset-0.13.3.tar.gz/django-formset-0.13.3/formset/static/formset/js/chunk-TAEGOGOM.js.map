{
  "version": 3,
  "sources": ["../../../../client/django-formset/SortableSelect.ts"],
  "sourcesContent": ["import Sortable, { MultiDrag, SortableEvent } from 'sortablejs';\nimport { StyleHelpers } from './helpers';\nimport styles from './SortableSelect.scss';\n\nSortable.mount(new MultiDrag());\n\n\nexport class SortableSelectElement extends HTMLElement {\n\tprivate readonly declaredStyles: HTMLStyleElement;\n\tprivate lastSelected: HTMLOptionElement | null = null;\n\n\tpublic constructor() {\n\t\tsuper();\n\t\tthis.declaredStyles = document.createElement('style');\n\t\tthis.declaredStyles.innerText = styles;\n\t\tdocument.head.appendChild(this.declaredStyles);\n\n\t\tthis.addEventListener('click', event => this.optionSelected(event));\n\t\twindow.addEventListener('click', event => this.elementFocus(event));\n\t}\n\n\tpublic initialize(selectElement: HTMLSelectElement) {\n\t\tthis.transferStyles(selectElement);\n\t\tSortable.create(this, {\n\t\t\tanimation: 150,\n\t\t\tfallbackOnBody: true,\n\t\t\tmultiDrag: true,\n\t\t\tonEnd: event => this.onEnd(event),\n\t\t});\n\t\tthis.querySelectorAll('optgroup').forEach(optgroup => {\n\t\t\tSortable.create(this, {\n\t\t\t\tanimation: 150,\n\t\t\t\tfallbackOnBody: true,\n\t\t\t\tmultiDrag: true,\n\t\t\t\tonEnd: event => this.onEnd(event),\n\t\t\t\thandle: '>option',\n\t\t\t\tgroup: optgroup.label,\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate onEnd(event: SortableEvent) {\n\t\tthis.deselectAllOptions();\n\t\tconst sortedEvent = new Event('options-sorted', {\n\t\t\tbubbles: true,\n\t\t\tcancelable: true,\n\t\t\tcomposed: false\n\t\t});\n\t\tthis.dispatchEvent(sortedEvent);\n\t}\n\n\tprivate elementFocus(event: Event) {\n\t\tif (event.target instanceof HTMLElement && this.contains(event.target)) {\n\t\t\tthis.classList.add('focus');\n\t\t} else {\n\t\t\tthis.classList.remove('focus');\n\t\t}\n\t}\n\n\tprivate optionSelected(event: Event) {\n\t\tif (!(event.target instanceof HTMLOptionElement))\n\t\t\treturn;\n\t\tconst selectedOption = event.target;\n\t\tif (event instanceof PointerEvent && event.metaKey) {\n\t\t\tif (selectedOption.selected = !selectedOption.selected) {\n\t\t\t\tSortable.utils.select(selectedOption);\n\t\t\t} else {\n\t\t\t\tSortable.utils.deselect(selectedOption);\n\t\t\t}\n\t\t} else if (event instanceof PointerEvent && event.shiftKey && this.lastSelected) {\n\t\t\tthis.deselectAllOptions();\n\t\t\tlet setSeleted = false;\n\t\t\tfor (let option of this.getElementsByTagName('option')) {\n\t\t\t\tif (option === selectedOption || option === this.lastSelected) {\n\t\t\t\t\toption.selected = true;\n\t\t\t\t\tsetSeleted = !setSeleted;\n\t\t\t\t} else {\n\t\t\t\t\toption.selected = setSeleted;\n\t\t\t\t}\n\t\t\t\tif (option.selected) {\n\t\t\t\t\tSortable.utils.select(option);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.deselectAllOptions();\n\t\t\tselectedOption.selected = true;\n\t\t\tSortable.utils.select(selectedOption);\n\t\t}\n\t\tthis.lastSelected = selectedOption;\n\t\tevent.preventDefault();\n\t}\n\n\tprivate deselectAllOptions() {\n\t\tfor (let option of this.getElementsByTagName('option')) {\n\t\t\toption.selected = false;\n\t\t\tSortable.utils.deselect(option);\n\t\t}\n\t}\n\n\tprivate transferStyles(selectElement: HTMLSelectElement) {\n\t\tconst sheet = this.declaredStyles.sheet;\n\t\tconst optionElement = selectElement.querySelector('option');\n\t\tfor (let index = 0; sheet && index < sheet.cssRules.length; index++) {\n\t\t\tconst cssRule = sheet.cssRules.item(index) as CSSStyleRule;\n\t\t\tlet extraStyles: string;\n\t\t\tswitch (cssRule.selectorText) {\n\t\t\t\tcase 'django-sortable-select':\n\t\t\t\t\textraStyles = StyleHelpers.extractStyles(selectElement, [\n\t\t\t\t\t\t'display', 'width', 'height', 'border', 'box-shadow', 'outline', 'overflow',\n\t\t\t\t\t\t'font-family', 'font-size', 'font-strech', 'font-style', 'font-weight',\n\t\t\t\t\t\t'letter-spacing', 'white-space', 'line-height']);\n\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'django-sortable-select.focus':\n\t\t\t\t\tselectElement.style.transition = 'none';\n\t\t\t\t\tselectElement.focus();\n\t\t\t\t\textraStyles = StyleHelpers.extractStyles(selectElement, [\n\t\t\t\t\t\t'border', 'box-shadow', 'outline']);\n\t\t\t\t\tselectElement.blur();\n\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\tselectElement.style.transition = '';\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'django-sortable-select option.sortable-chosen, django-sortable-select option.sortable-selected':\n\t\t\t\t\tif (optionElement) {\n\t\t\t\t\t\toptionElement.selected = true;\n\t\t\t\t\t\textraStyles = StyleHelpers.extractStyles(optionElement, [\n\t\t\t\t\t\t\t'color', 'background-color']);\n\t\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\t\toptionElement.selected = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'django-sortable-select.focus option.sortable-chosen, django-sortable-select.focus option.sortable-selected':\n\t\t\t\t\tselectElement.focus();\n\t\t\t\t\tif (optionElement) {\n\t\t\t\t\t\toptionElement.selected = true;\n\t\t\t\t\t\textraStyles = StyleHelpers.extractStyles(optionElement, [\n\t\t\t\t\t\t\t'color', 'background-color']);\n\t\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{${extraStyles}}`, ++index);\n\t\t\t\t\t\toptionElement.selected = false;\n\t\t\t\t\t}\n\t\t\t\t\tselectElement.blur();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'django-sortable-select optgroup option::before':\n\t\t\t\t\tsheet.insertRule(`${cssRule.selectorText}{content:\"\\\\0000a0\\\\0000a0\\\\0000a0\\\\0000a0\";}`, ++index);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic add(element: HTMLOptionElement | HTMLOptGroupElement) {\n\t\tif (element instanceof HTMLOptionElement) {\n\t\t\tthis.appendChild(element);\n\t\t\tSortable.utils.select(element);\n\t\t} else if (element instanceof HTMLOptGroupElement) {\n\t\t\tthis.appendChild(element);\n\t\t\tSortable.create(element, {\n\t\t\t\tanimation: 150,\n\t\t\t\tfallbackOnBody: true,\n\t\t\t\tmultiDrag: true,\n\t\t\t\tonEnd: event => this.onEnd(event),\n\t\t\t\thandle: '>option',\n\t\t\t});\n\t\t}\n\t}\n}\n\n\nexport class SortableOptGroupElement extends HTMLOptGroupElement {\n\tprivate lastSelected: HTMLOptionElement | null = null;\n\n\tpublic constructor() {\n\t\tsuper();\n\t}\n}\n"],
  "mappings": "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",
  "names": ["sortable_esm_default", "MultiDragPlugin", "SortableSelectElement", "SortableSelect_default", "event", "selectElement", "optgroup", "sortedEvent", "selectedOption", "setSeleted", "option", "sheet", "optionElement", "index", "cssRule", "extraStyles", "StyleHelpers", "element", "SortableOptGroupElement"]
}
