import{F as T,_ as D,d as w,i as F,a as C,t as q,c as b,o as $,b as S,e as u,f as N,u as k,g as M,h as G,j as E,r as P,p as V,k as U,l as X,w as A,v as O,m as Y,n as Q,q as Z,s as ee,x as te,y as ne,z as oe,A as se,B as ae,C as re,D as le}from"./index.3d3e0d39.js";function L(i){const m=/[\\]?@{([\w\s.]*)}/g;function _(n){const o={};for(let s=0;s<n.length-1;s++){const l=n[s],{componentId:e}=l,{type:a}=i.getComponentById(e);if(a!=="repeater"||s+1>=n.length)continue;const t=n.slice(0,s+1),v=n.slice(0,s+2),{instanceNumber:p}=v.at(-1),y=g(t,"repeaterObject"),h=Object.entries(y),R=g(t,"keyVariable"),j=g(t,"valueVariable");o[R]=h[p][0],o[j]=h[p][1]}return o}function r(n,o){if(n==null)return null;let s;const l=_(o),e=n.replace(m,(t,v)=>{if(t.charAt(0)=="\\")return t.substring(1);const p=v.trim();if(!p)return;const y=i.evaluateExpression(p,l);if(typeof y!="undefined"){if(p===t){s=y;return}return typeof y=="object"?JSON.stringify(y):y}});return typeof s=="undefined"?e:s}function c(n){const{componentId:o}=n.at(-1),s=i.getComponentById(o);if(!s)return;const l={},{fields:e}=i.getComponentDefinition(s.type);return Object.keys(e).forEach(a=>{l[a]=g(n,a)}),l}function g(n,o){var y;const{componentId:s}=n.at(-1),l=i.getComponentById(s),{fields:e}=i.getComponentDefinition(l.type),a=(y=l.content)==null?void 0:y[o],t=e[o].default,v=r(a,n),p=e[o].type;if(p==T.Object||p==T.KeyValue){if(!v)return t?JSON.parse(t):null;if(typeof v!="string")return v;let h;try{h=JSON.parse(v)}catch{return t?JSON.parse(t):null}return h}else if(p==T.Number){const h=parseFloat(v);return typeof h===void 0||Number.isNaN(h)?parseFloat(t):h}else if(p==T.Text||T.Color)return typeof a=="undefined"||a===null||a===""?t:v}return{getEvaluatedFields:c}}const ce={class:"ChildlessPlaceholder"},ie={class:"content"},de={class:"title"},ue={key:0,class:"message"},pe=w({__name:"ChildlessPlaceholder",props:{componentId:null},setup(i){const m=i,_=10,r=F(C.core),{componentId:c}=q(m),g=b(()=>r.getComponentById(c.value)),n=b(()=>r.getComponentDefinition(g.value.type)),o=(l,e)=>{const t=l.map(p=>r.getComponentDefinition(p)).map(p=>p==null?void 0:p.name);return`${t.slice(0,-1).join(", ")} ${t.length>1?e:""} ${t.at(-1)}`},s=b(()=>{const l=r.getContainableTypes(c.value);let e;return l.length<=_&&(e=`You can add ${o(l,"and")} components`),e});return(l,e)=>($(),S("div",ce,[u("div",ie,[u("div",de,[u("h2",null,"Empty "+N(k(n).name),1)]),k(s)?($(),S("div",ue,N(k(s)),1)):M("",!0)])]))}});var me=D(pe,[["__scopeId","data-v-2c55ffd3"]]);const _e=i=>E("div",`Component type ${i} not supported.`),ve={props:["componentId","instancePath","instanceData"],setup(i){const m=F(C.core),_=F(C.builderManager),r=i.componentId,c=b(()=>m.getComponentById(r)),g=G[c.value.type];if(!g)return _e(c.value.type);const n=i.instancePath,o=i.instanceData,s=L(m),l=b(()=>s.getEvaluatedFields(n)),e=b(()=>m.getComponents(r,!0)),a=()=>{if(!(e.value.length>0)&&c.value.type!="html")return E(me,{componentId:c.value.id})},t=(d,f=0)=>E(J,{componentId:d,key:`${d}:${f}`,instancePath:[...n,{componentId:d,instanceNumber:f}],instanceData:[...o,P(null)]}),v=(d=0)=>{const f=x=>E("div",{"data-streamsync-slot-of-id":r,"data-streamsync-position":x}),I=e.value.map((x,K)=>[t(x.id,d),..._?[f(K+1)]:[]]);return[..._?[f(0)]:[]].concat(I.flat())};V(C.evaluatedFields,l),V(C.componentId,r),V(C.setFormValue,d=>m.setFormValue(r,d)),V(C.instancePath,n),V(C.instanceData,o),V(C.renderProxiedComponent,t),V(C.getChildrenVNodes,v);const y={"data-streamsync-id":r,"data-streamsync-instance-path":(d=>d.map(f=>`${f.componentId}:${f.instanceNumber}`).join(","))(n)},h=b(()=>e.value.length==0),R=b(()=>(_==null?void 0:_.getSelectedId())==r),j=b(()=>m.isComponentVisible(r)),W=d=>{if(!d.startsWith("$"))return I=>m.forwardEvent(I,n);if(d.startsWith("$goToPage_")){const I=d.substring(10);return x=>m.setActivePageFromKey(I)}return null},z=b(()=>{const d={};return Object.entries(c.value.handlers).forEach(([f,I])=>{const x=`on${f.charAt(0).toUpperCase()}${f.slice(1)}`;d[x]=W(I)}),d}),H=function(){return{class:{component:!0,childless:h.value,selected:R.value},style:j.value?{}:{display:"none"},...y,...z.value,draggable:!!_}};return()=>{const d=h.value?a:({instanceNumber:x})=>v(x),f={...H()};return E(g,f,{default:d})}}};var J=D(ve,[["__scopeId","data-v-25e29766"]]);const B=i=>(te("data-v-7b5e8d5e"),i=i(),ne(),i),fe=B(()=>u("i",{class:"ri-notification-2-line ri-xl"},null,-1)),ge={class:"counter"},he=B(()=>u("div",{class:"balloonFlash"},null,-1)),ye={class:"main"},Ce=B(()=>u("i",{class:"ri-close-line"},null,-1)),be=B(()=>u("i",{class:"ri-error-warning-fill ri-xl"},null,-1)),Ie=[be],xe={class:"content"},Ve={class:"title"},$e={class:"time"},Ne={class:"message"},Se=w({__name:"RendererNotifications",setup(i){const m=F(C.core),_=P(!1),r=P(null),c=U([]),g=s=>{const{type:l,title:e,message:a,code:t}=s;c.unshift({type:l,title:e,message:a,code:t,timestampReceived:new Date}),c.splice(100),r.value.classList.remove("alert"),r.value.offsetWidth,r.value.classList.add("alert")};X(()=>{m.addMailSubscription("notification",g)});const n=()=>{c.length!=0&&(_.value=!_.value)},o=()=>{c.splice(0),_.value=!1};return(s,l)=>A(($(),S("div",{class:"RendererNotifications",onClick:n},[u("div",{class:"balloon",ref_key:"balloon",ref:r,title:"Toggle notifications"},[fe,u("div",ge,N(c.length),1)],512),he,A(u("div",ye,[u("div",{class:"clearContainer"},[u("button",{onClick:o},[Ce,Y(" Clear all ")])]),($(!0),S(Q,null,Z(c,(e,a)=>($(),S("div",{class:"notification",key:a},[u("div",{class:ee(["icon",e.type])},Ie,2),u("div",xe,[u("header",null,[u("strong",Ve,N(e.title),1),u("span",$e,N(e.timestampReceived.toLocaleTimeString()),1)]),u("div",Ne,N(e.message),1)])]))),128))],512),[[O,_.value]])],512)),[[O,c.length>0]])}});var Pe=D(Se,[["__scopeId","data-v-7b5e8d5e"]]);const Te={class:"rootComponentArea"},Ee=w({__name:"ComponentRenderer",setup(i){const m=F(C.core),_=L(m),r=m.getComponents();P([]),r.length==0&&console.error("No pages found.");const c=[{componentId:"root",instanceNumber:0}],g=[P(null)],n=P(r[0]),o=b(()=>_.getEvaluatedFields(c)),s=b(()=>({"--accentColor":o.value.accentColor,"--emptinessColor":o.value.emptinessColor,"--containerBackgroundColor":o.value.parentIdBackgroundColor,"--primaryTextColor":o.value.primaryTextColor,"--secondaryTextColor":o.value.secondaryTextColor,"--separatorColor":o.value.separatorColor}));oe(()=>o.value.appName,e=>{l(e)},{immediate:!0});function l(e){const a=m.getMode();let t;e&&a=="edit"?t=`${e} | Streamsync Builder`:!e&&a=="edit"?t="Streamsync Builder":e&&a=="run"?t=`${e}`:!e&&a=="run"&&(t="Streamsync App"),document.title=t}return(e,a)=>($(),S("div",{class:"ComponentRenderer",tabindex:"-1",style:le(k(s))},[se(Pe,{class:"notifications"}),u("div",Te,[n.value?($(),ae(J,{key:0,"component-id":n.value.id,"instance-path":c,"instance-data":g},null,8,["component-id"])):M("",!0),re(e.$slots,"default",{},void 0,!0)])],4))}});var De=D(Ee,[["__scopeId","data-v-7e515240"]]);export{De as default};
