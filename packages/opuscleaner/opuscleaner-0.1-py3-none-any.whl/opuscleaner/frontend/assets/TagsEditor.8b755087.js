import{i as f,j as y,_ as C,k as P,l as $,o as u,a as B,c as d,d as c,F as k,r as x,m as N,v as V,u as g,n as F,f as q,t as w,q as R,s as A,T as M,p as U,h as z,b as h,x as J,E as L}from"./index.490d1368.js";function G(t,a,n){const e=new Map(t.map(s=>[n(s),s])),o=a.map(s=>e.has(n(s))?Object.assign(e.get(n(s)),s):s);t.splice(0,t.length,...o)}const _=f([]);async function D(){const t=await fetch("/api/datasets/");G(_.value,await t.json(),a=>a.name)}let m=null;function ce(){return m||(m=D()),_.value}function le(t){const a=_.value.find(e=>e.name===t);if(a)return a;const n=y({name:t});return _.value.push(n),m||(m=D()),n}const i=y({categories:[],mapping:{}});async function H(){return await(await fetch("/api/categories/")).json()}async function K(){return await fetch("/api/categories/",{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)})}let b=null;function j(){return b||(b=H().then(t=>Object.assign(i,t))),i}function T(){return j().categories}function S(t){const a=j();return Object.entries(a.mapping).reduce((n,[e,o])=>o.includes(t.name)?[...n,a.categories.find(s=>s.name==e)]:n,[])}function Q(t,a){const n=new Set(t.map(e=>e.name));T().forEach(({name:e})=>{if(n.has(e))e in i.mapping?i.mapping[e].includes(a.name)||i.mapping[e].push(a.name):i.mapping[e]=[a.name];else if(e in i.mapping){let o;for(;(o=i.mapping[e].indexOf(a.name))!==-1;)i.mapping[e].splice(o,1)}}),K()}const W=t=>(U("data-v-fdef0114"),t=t(),z(),t),X=W(()=>c("header",null," Set categories ",-1)),Y={class:"category-list"},Z=["value"],ee={__name:"CategoryPicker",setup(t,{expose:a}){const n=y({top:"0px",left:"0px"});f(!1);const e=f(null);let o=f(null);const s=P({get(){return e.value===null?null:o.value!==null?o.value:S(e.value)},set(r){o.value=r.slice()}});$(e,function(r,l){(r==null?void 0:r.name)!==(l==null?void 0:l.name)&&(o.value=null)},{deep:!0});function E(){console.assert(e.value!==null),o.value!==null&&(Q(o.value,e.value),o.value=null),v()}async function I(r,l){if(e.value=r,l){const p=l.target.getBoundingClientRect();Object.assign(n,{top:`${p.bottom}px`,left:`${p.left}px`})}}function v(){e.value=null}return a({showForDataset:I,hide:v}),(r,l)=>(u(),B(M,{to:"body"},[e.value!==null?(u(),d("div",{key:0,ref:"element",class:"popup",style:R(n)},[X,c("ol",Y,[(u(!0),d(k,null,x(g(T)(),p=>(u(),d("li",{key:p.name},[c("label",null,[N(c("input",{type:"checkbox","onUpdate:modelValue":l[0]||(l[0]=O=>F(s)?s.value=O:null),value:p},null,8,Z),[[V,g(s)]]),q(" "+w(p.name),1)])]))),128))]),c("footer",null,[c("button",{onClick:v},"Cancel"),c("button",{onClick:E},"Apply")])],4)):A("",!0)]))}},te=C(ee,[["__scopeId","data-v-fdef0114"]]);const ae={class:"tags-container"},se={class:"category-tags"},ne={class:"tag-name"},oe={__name:"TagsEditor",props:{dataset:Object},setup(t){const a=t,n=f();return(e,o)=>(u(),d("div",ae,[c("div",se,[(u(!0),d(k,null,x(g(S)(a.dataset),s=>(u(),d("span",{class:"tag",key:s.name},[h(g(J)),c("span",ne,w(s.name),1)]))),128))]),c("button",{class:"icon-button",onClick:o[0]||(o[0]=s=>n.value.showForDataset(a.dataset,s)),title:"Change dataset tags"},[h(g(L))]),h(te,{ref_key:"categoryPicker",ref:n},null,512)]))}},re=C(oe,[["__scopeId","data-v-d8e2ba32"]]);export{re as T,le as a,ce as g};
