[tox]
envlist =
   system-staticcheck
   3.10-{unit,doctest,lint}
   {3.8,3.9,3.11}-unit
skip_missing_interpreters = true

[testenv]
passenv = HYPOTHESIS_PROFILE
install_command = python -m pip install --prefer-binary {opts} {packages}

basepython=
   3.8: python3.8
   3.9: python3.9
   3.10: python3.10
   3.11: python3.11
   system: python


deps = pytest==7.1.2
       hypothesis>=6.30,<7.0
       coverage==6.4.1
       pytz
       ipdb
       debugpy
       doctest: Sphinx>=4.4.0,<5.0
       staticcheck: mypy==0.941
       staticcheck: types-backports
       staticcheck: types-pytz
       lint: flake8-bugbear==22.1.11
       lint: flake8~=4.0.1
       lint: black~=22.3.0
       lint: isort~=5.10.1
       shell: ipython
       fmt: black~=22.3.0
       fmt: isort~=5.10.1

sitepackages = False
allowlist_externals =
     /usr/bin/make

commands=
   unit: coverage run --rcfile=setup.cfg -m pytest -l --hypothesis-show-statistics --color=no []
   doctest: make -C docs/ doctest
   lint: flake8 xotl/plato/ tests/
   lint: black --check xotl/plato/ tests/
   lint: isort -c --df xotl/plato/ tests/
   shell: ipython --profile-dir={toxinidir}/.ipython


[testenv:system-staticcheck]
skip_install = true

commands:
    pip install --prefer-binary --no-color -e {toxinidir}
    mypy -p xotl.plato --config-file {toxinidir}/mypy.ini

[testenv:system-fmt]
skip_install = true

commands:
    black {toxinidir}/tests {toxinidir}/xotl/
    isort {toxinidir}/tests {toxinidir}/xotl/
