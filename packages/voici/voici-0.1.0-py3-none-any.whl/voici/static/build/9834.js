/*! For license information please see 9834.js.LICENSE.txt */
"use strict";(self.webpackChunk_JUPYTERLAB_CORE_OUTPUT=self.webpackChunk_JUPYTERLAB_CORE_OUTPUT||[]).push([[9834],{49834:(e,t,i)=>{i.r(t),i.d(t,{PIPLITE_WHEEL:()=>_,PyoliteKernel:()=>w,PyoliteRemoteKernel:()=>k,allJSONUrl:()=>n,ipykernelWheelUrl:()=>s,pipliteWheelUrl:()=>a,pyoliteWheelUrl:()=>r,widgetsnbextensionWheelUrl:()=>o,widgetsnbextensionWheelUrl1:()=>l});var n={};i.r(n),i.d(n,{default:()=>p});var s={};i.r(s),i.d(s,{default:()=>c});var a={};i.r(a),i.d(a,{default:()=>u});var r={};i.r(r),i.d(r,{default:()=>h});var o={};i.r(o),i.d(o,{default:()=>d});var l={};i.r(l),i.d(l,{default:()=>m});const p=i.p+"pypi/all.json",c=i.p+"pypi/ipykernel-6.9.2-py3-none-any.whl",u=i.p+"pypi/piplite-0.1.0b18-py3-none-any.whl",h=i.p+"pypi/pyolite-0.1.0b18-py3-none-any.whl",d=i.p+"pypi/widgetsnbextension-3.6.0-py3-none-any.whl",m=i.p+"pypi/widgetsnbextension-4.0.2-py3-none-any.whl",_="piplite-0.1.0b18-py3-none-any.whl";var y=i(92233),f=i(59110),g=i(94778),b=i(86083);class w extends g.BaseKernel{constructor(e){super(e),this._ready=new y.PromiseDelegate,this._worker=this.initWorker(e),this._worker.onmessage=e=>this._processWorkerMessage(e.data),this._remoteKernel=(0,b.Ud)(this._worker),this.initRemote(e)}initWorker(e){return new Worker(new URL(i.p+i.u(1808),i.b),{type:void 0})}async initRemote(e){const t=this.initRemoteOptions(e);await this._remoteKernel.initialize(t),this._ready.resolve()}initRemoteOptions(e){const{pyodideUrl:t}=e,i=t.slice(0,t.lastIndexOf("/")+1),n=f.PageConfig.getBaseUrl(),s=f.URLExt.join(n,"build/pypi"),a=[...e.pipliteUrls||[],f.URLExt.join(s,"all.json")];return{baseUrl:n,pyodideUrl:t,indexUrl:i,pipliteWheelUrl:f.URLExt.join(s,_),pipliteUrls:a,disablePyPIFallback:!!e.disablePyPIFallback,location:this.location,mountDrive:e.mountDrive}}dispose(){this.isDisposed||(this._worker.terminate(),this._worker=null,super.dispose())}get ready(){return this._ready.promise}_processWorkerMessage(e){var t,i,n,s,a,r,o;if(e.type)switch(e.type){case"stream":{const i=null!==(t=e.bundle)&&void 0!==t?t:{name:"stdout",text:""};this.stream(i,e.parentHeader);break}case"input_request":{const t=null!==(i=e.content)&&void 0!==i?i:{prompt:"",password:!1};this.inputRequest(t,e.parentHeader);break}case"display_data":{const t=null!==(n=e.bundle)&&void 0!==n?n:{data:{},metadata:{},transient:{}};this.displayData(t,e.parentHeader);break}case"update_display_data":{const t=null!==(s=e.bundle)&&void 0!==s?s:{data:{},metadata:{},transient:{}};this.updateDisplayData(t,e.parentHeader);break}case"clear_output":{const t=null!==(a=e.bundle)&&void 0!==a?a:{wait:!1};this.clearOutput(t,e.parentHeader);break}case"execute_result":{const t=null!==(r=e.bundle)&&void 0!==r?r:{execution_count:0,data:{},metadata:{}};this.publishExecuteResult(t,e.parentHeader);break}case"execute_error":{const t=null!==(o=e.bundle)&&void 0!==o?o:{ename:"",evalue:"",traceback:[]};this.publishExecuteError(t,e.parentHeader);break}case"comm_msg":case"comm_open":case"comm_close":this.handleComm(e.type,e.content,e.metadata,e.buffers,e.parentHeader)}}async kernelInfoRequest(){return{implementation:"pyodide",implementation_version:"0.1.0",language_info:{codemirror_mode:{name:"python",version:3},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:"ipython3",version:"3.8"},protocol_version:"5.3",status:"ok",banner:"Pyolite: A WebAssembly-powered Python kernel backed by Pyodide",help_links:[{text:"Python (WASM) Kernel",url:"https://pyodide.org"}]}}async executeRequest(e){await this.ready;const t=await this._remoteKernel.execute(e,this.parent);return t.execution_count=this.executionCount,t}async completeRequest(e){return await this._remoteKernel.complete(e,this.parent)}async inspectRequest(e){return await this._remoteKernel.inspect(e,this.parent)}async isCompleteRequest(e){return await this._remoteKernel.isComplete(e,this.parent)}async commInfoRequest(e){return await this._remoteKernel.commInfo(e,this.parent)}async commOpen(e){return await this._remoteKernel.commOpen(e,this.parent)}async commMsg(e){return await this._remoteKernel.commMsg(e,this.parent)}async commClose(e){return await this._remoteKernel.commClose(e,this.parent)}async inputReply(e){return await this._remoteKernel.inputReply(e,this.parent)}}class k{constructor(){this._options=null,this._initializer=null,this._pyodide=null,this._localPath="",this._driveName="",this._driveFS=null,this._initialized=new Promise(((e,t)=>{this._initializer={resolve:e,reject:t}}))}async initialize(e){var t;if(this._options=e,e.location.includes(":")){const t=e.location.split(":");this._driveName=t[0],this._localPath=t[1]}else this._driveName="",this._localPath=e.location;await this.initRuntime(e),await this.initFilesystem(e),await this.initPackageManager(e),await this.initKernel(e),await this.initGlobals(e),null===(t=this._initializer)||void 0===t||t.resolve()}async initRuntime(e){const{pyodideUrl:t,indexUrl:i}=e;let n;t.endsWith(".mjs")?n=(await import(t)).loadPyodide:(importScripts(t),n=self.loadPyodide),this._pyodide=await n({indexURL:i})}async initPackageManager(e){if(!this._options)throw new Error("Uninitialized");const{pipliteWheelUrl:t,disablePyPIFallback:i,pipliteUrls:n}=this._options;await this._pyodide.loadPackage(["micropip"]),await this._pyodide.runPythonAsync(`\n      import micropip\n      await micropip.install('${t}', keep_going=True)\n      import piplite.piplite\n      piplite.piplite._PIPLITE_DISABLE_PYPI = ${i?"True":"False"}\n      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(n)}\n    `)}async initKernel(e){await this._pyodide.runPythonAsync("\n      await piplite.install(['sqlite3'], keep_going=True);\n      await piplite.install(['ipykernel'], keep_going=True);\n      await piplite.install(['pyolite'], keep_going=True);\n      await piplite.install(['ipython'], keep_going=True);\n      import pyolite\n    "),e.mountDrive&&this._localPath&&await this._pyodide.runPythonAsync(`\n        import os;\n        os.chdir("${this._localPath}");\n      `)}async initGlobals(e){const{globals:t}=this._pyodide;this._kernel=t.get("pyolite").kernel_instance.copy(),this._stdout_stream=t.get("pyolite").stdout_stream.copy(),this._stderr_stream=t.get("pyolite").stderr_stream.copy(),this._interpreter=this._kernel.interpreter.copy(),this._interpreter.send_comm=this.sendComm.bind(this)}async initFilesystem(e){if(e.mountDrive){const t="/drive",{FS:n,PATH:s,ERRNO_CODES:a}=this._pyodide,{baseUrl:r}=e,{DriveFS:o}=await i.e(1878).then(i.t.bind(i,71878,23)),l=new o({FS:n,PATH:s,ERRNO_CODES:a,baseUrl:r,driveName:this._driveName,mountpoint:t});n.mkdir(t),n.mount(l,{},t),n.chdir(t),this._driveFS=l}}mapToObject(e){const t=e instanceof Array?[]:{};return e.forEach(((e,i)=>{t[i]=e instanceof Map||e instanceof Array?this.mapToObject(e):e})),t}formatResult(e){if(!this._pyodide.isPyProxy(e))return e;const t=e.toJs();return this.mapToObject(t)}async setup(e){await this._initialized,this._kernel._parent_header=this._pyodide.toPy(e)}async execute(e,t){await this.setup(t);const i=(e,t)=>{const i={name:this.formatResult(e),text:this.formatResult(t)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:i,type:"stream"})};this._stdout_stream.publish_stream_callback=i,this._stderr_stream.publish_stream_callback=i,this._interpreter.display_pub.clear_output_callback=e=>{const t={wait:this.formatResult(e)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:t,type:"clear_output"})},this._interpreter.display_pub.display_data_callback=(e,t,i)=>{const n={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(i)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"display_data"})},this._interpreter.display_pub.update_display_data_callback=(e,t,i)=>{const n={data:this.formatResult(e),metadata:this.formatResult(t),transient:this.formatResult(i)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"update_display_data"})},this._interpreter.displayhook.publish_execution_result=(e,t,i)=>{const n={execution_count:e,data:this.formatResult(t),metadata:this.formatResult(i)};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"execute_result"})},this._interpreter.input=this.input.bind(this),this._interpreter.getpass=this.getpass.bind(this);const n=await this._kernel.run(e.code),s=this.formatResult(n);return"error"===s.status&&((e,t,i)=>{const n={ename:e,evalue:t,traceback:i};postMessage({parentHeader:this.formatResult(this._kernel._parent_header).header,bundle:n,type:"execute_error"})})(s.ename,s.evalue,s.traceback),s}async complete(e,t){await this.setup(t);const i=this._kernel.complete(e.code,e.cursor_pos);return this.formatResult(i)}async inspect(e,t){await this.setup(t);const i=this._kernel.inspect(e.code,e.cursor_pos,e.detail_level);return this.formatResult(i)}async isComplete(e,t){await this.setup(t);const i=this._kernel.is_complete(e.code);return this.formatResult(i)}async commInfo(e,t){await this.setup(t);const i=this._kernel.comm_info(e.target_name);return this.formatResult(i)}async commOpen(e,t){await this.setup(t);const i=this._kernel.comm_manager.comm_open(this._pyodide.toPy(e));return this.formatResult(i)}async commMsg(e,t){await this.setup(t);const i=this._kernel.comm_manager.comm_msg(this._pyodide.toPy(e));return this.formatResult(i)}async commClose(e,t){await this.setup(t);const i=this._kernel.comm_manager.comm_close(this._pyodide.toPy(e));return this.formatResult(i)}async inputReply(e,t){await this.setup(t),this._resolveInputReply(e)}async sendInputRequest(e,t){const i={prompt:e,password:t};postMessage({type:"input_request",parentHeader:this.formatResult(this._kernel._parent_header).header,content:i})}async getpass(e){e=void 0===e?"":e,await this.sendInputRequest(e,!0);const t=new Promise((e=>{this._resolveInputReply=e}));return(await t).value}async input(e){e=void 0===e?"":e,await this.sendInputRequest(e,!1);const t=new Promise((e=>{this._resolveInputReply=e}));return(await t).value}async sendComm(e,t,i,n,s){postMessage({type:e,content:this.formatResult(t),metadata:this.formatResult(i),ident:this.formatResult(n),buffers:this.formatResult(s),parentHeader:this.formatResult(this._kernel._parent_header).header})}}},86083:(e,t,i)=>{i.d(t,{Ud:()=>h});const n=Symbol("Comlink.proxy"),s=Symbol("Comlink.endpoint"),a=Symbol("Comlink.releaseProxy"),r=Symbol("Comlink.finalizer"),o=Symbol("Comlink.thrown"),l=e=>"object"==typeof e&&null!==e||"function"==typeof e,p=new Map([["proxy",{canHandle:e=>l(e)&&e[n],serialize(e){const{port1:t,port2:i}=new MessageChannel;return c(e,t),[i,[i]]},deserialize:e=>(e.start(),h(e))}],["throw",{canHandle:e=>l(e)&&o in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function c(e,t=globalThis,i=["*"]){t.addEventListener("message",(function s(a){if(!a||!a.data)return;if(!function(e,t){for(const i of e){if(t===i||"*"===i)return!0;if(i instanceof RegExp&&i.test(t))return!0}return!1}(i,a.origin))return void console.warn(`Invalid origin '${a.origin}' for comlink proxy`);const{id:l,type:p,path:h}=Object.assign({path:[]},a.data),d=(a.data.argumentList||[]).map(k);let m;try{const t=h.slice(0,-1).reduce(((e,t)=>e[t]),e),i=h.reduce(((e,t)=>e[t]),e);switch(p){case"GET":m=i;break;case"SET":t[h.slice(-1)[0]]=k(a.data.value),m=!0;break;case"APPLY":m=i.apply(t,d);break;case"CONSTRUCT":m=function(e){return Object.assign(e,{[n]:!0})}(new i(...d));break;case"ENDPOINT":{const{port1:t,port2:i}=new MessageChannel;c(e,i),m=function(e,t){return b.set(e,t),e}(t,[t])}break;case"RELEASE":m=void 0;break;default:return}}catch(e){m={value:e,[o]:0}}Promise.resolve(m).catch((e=>({value:e,[o]:0}))).then((i=>{const[n,a]=w(i);t.postMessage(Object.assign(Object.assign({},n),{id:l}),a),"RELEASE"===p&&(t.removeEventListener("message",s),u(t),r in e&&"function"==typeof e[r]&&e[r]())})).catch((e=>{const[i,n]=w({value:new TypeError("Unserializable return value"),[o]:0});t.postMessage(Object.assign(Object.assign({},i),{id:l}),n)}))})),t.start&&t.start()}function u(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function h(e,t){return f(e,[],t)}function d(e){if(e)throw new Error("Proxy has been released and is not useable")}function m(e){return R(e,{type:"RELEASE"}).then((()=>{u(e)}))}const _=new WeakMap,y="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(_.get(e)||0)-1;_.set(e,t),0===t&&m(e)}));function f(e,t=[],i=function(){}){let n=!1;const r=new Proxy(i,{get(i,s){if(d(n),s===a)return()=>{!function(e){y&&y.unregister(e)}(r),m(e),n=!0};if("then"===s){if(0===t.length)return{then:()=>r};const i=R(e,{type:"GET",path:t.map((e=>e.toString()))}).then(k);return i.then.bind(i)}return f(e,[...t,s])},set(i,s,a){d(n);const[r,o]=w(a);return R(e,{type:"SET",path:[...t,s].map((e=>e.toString())),value:r},o).then(k)},apply(i,a,r){d(n);const o=t[t.length-1];if(o===s)return R(e,{type:"ENDPOINT"}).then(k);if("bind"===o)return f(e,t.slice(0,-1));const[l,p]=g(r);return R(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:l},p).then(k)},construct(i,s){d(n);const[a,r]=g(s);return R(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:a},r).then(k)}});return function(e,t){const i=(_.get(t)||0)+1;_.set(t,i),y&&y.register(e,t,e)}(r,e),r}function g(e){const t=e.map(w);return[t.map((e=>e[0])),(i=t.map((e=>e[1])),Array.prototype.concat.apply([],i))];var i}const b=new WeakMap;function w(e){for(const[t,i]of p)if(i.canHandle(e)){const[n,s]=i.serialize(e);return[{type:"HANDLER",name:t,value:n},s]}return[{type:"RAW",value:e},b.get(e)||[]]}function k(e){switch(e.type){case"HANDLER":return p.get(e.name).deserialize(e.value);case"RAW":return e.value}}function R(e,t,i){return new Promise((n=>{const s=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(i){i.data&&i.data.id&&i.data.id===s&&(e.removeEventListener("message",t),n(i.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:s},t),i)}))}}}]);