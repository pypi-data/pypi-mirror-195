"use strict";(self.webpackChunk_jupyter_ai_core=self.webpackChunk_jupyter_ai_core||[]).push([[819],{5819:(e,t,o)=>{o.r(t),o.d(t,{CommandIDs:()=>P,NotebookTasks:()=>M,default:()=>F});var n=o(5767),l=o(2650),r=o(4886),a=o(1258);const i="api/ai";async function c(e="",t={}){const o=a.ServerConnection.makeSettings(),n=r.URLExt.join(o.baseUrl,i,e);let l;try{l=await a.ServerConnection.makeRequest(n,t,o)}catch(e){throw new a.ServerConnection.NetworkError(e)}let c=await l.text();if(c.length>0)try{c=JSON.parse(c)}catch(e){console.log("Not a JSON response body.",l)}if(!l.ok)throw new a.ServerConnection.ResponseError(l,c.message||c);return c}var s;!function(e){e.sendPrompt=async function(e){let t;try{t=await c("prompt",{method:"POST",body:JSON.stringify(e)})}catch(e){return Promise.reject(e)}return t},e.listTasks=async function(){return c("tasks")},e.describeTask=async function(e){return c(`tasks/${e}`)}}(s||(s={}));var d=o(6271),u=o.n(d),p=o(4859),m=o(3191);function b(e){const[t,o]=(0,d.useState)(!1),[n,l]=(0,d.useState)(!1),{label:r,style:a,helperText:i,InputProps:c}=e,s=(0,d.useRef)(null);return(0,d.useEffect)((()=>{o(!1);const e=s.current;(null==e?void 0:e.offsetWidth)&&(null==e?void 0:e.scrollWidth)&&l(e.offsetWidth<e.scrollWidth)}),[e.text]),u().createElement("div",{id:e.id,style:{display:"flex",flexDirection:"column",...a}},u().createElement("span",{className:"jp-ai-ExpandableTextField-label"},r),u().createElement("div",{style:{display:"flex",flexDirection:"column"}},u().createElement("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},null==c?void 0:c.startAdornment,u().createElement("span",{className:"jp-ai-ExpandableTextField-value "+(t?"jp-ai-ExpandableTextField-value-expanded":"jp-ai-ExpandableTextField-value-collapsed"),ref:s},e.text?e.text:!(null==c?void 0:c.startAdornment)&&"—")),n&&u().createElement("div",{style:{textDecoration:"underline"},onClick:()=>o(!t),className:"jp-ai-ExpandableTextField-value"},t?"Show Less":"Show More"),u().createElement("span",{className:"jp-ai-ExpandableTextField-label",style:{maxWidth:"fit-content"}},i)))}async function f(e,t){return e.commands.execute(`ai:insert-${t.response.insertion_mode}`,t),!0}var v=o(1893);function g(e){return getComputedStyle(document.body).getPropertyValue(e).trim()}function y(){const e=document.body.getAttribute("data-jp-theme-light");return(0,v.Z)({spacing:4,components:{MuiButton:{defaultProps:{size:"small"}},MuiFilledInput:{defaultProps:{margin:"dense"}},MuiFormControl:{defaultProps:{margin:"dense",size:"small"}},MuiFormHelperText:{defaultProps:{margin:"dense"}},MuiIconButton:{defaultProps:{size:"small"}},MuiInputBase:{defaultProps:{margin:"dense",size:"small"}},MuiInputLabel:{defaultProps:{margin:"dense"}},MuiListItem:{defaultProps:{dense:!0}},MuiOutlinedInput:{defaultProps:{margin:"dense"}},MuiFab:{defaultProps:{size:"small"}},MuiTable:{defaultProps:{size:"small"}},MuiTextField:{defaultProps:{margin:"dense",size:"small"}},MuiToolbar:{defaultProps:{variant:"dense"}}},palette:{background:{paper:g("--jp-layout-color1"),default:g("--jp-layout-color1")},mode:"true"===e?"light":"dark",primary:{main:g("--jp-brand-color1"),light:g("--jp-brand-color2"),dark:g("--jp-brand-color0")},error:{main:g("--jp-error-color1"),light:g("--jp-error-color2"),dark:g("--jp-error-color0")},warning:{main:g("--jp-warn-color1"),light:g("--jp-warn-color2"),dark:g("--jp-warn-color0")},success:{main:g("--jp-success-color1"),light:g("--jp-success-color2"),dark:g("--jp-success-color0")},text:{primary:g("--jp-ui-font-color1"),secondary:g("--jp-ui-font-color2"),disabled:g("--jp-ui-font-color3")}},shape:{borderRadius:2},typography:{fontFamily:g("--jp-ui-font-family"),fontSize:12,htmlFontSize:16,button:{textTransform:"capitalize"}}})}const h={above:"AI output will be inserted above the selected text",replace:"AI output will replace the selected text",below:"AI output will be inserted below the selected text","above-in-cells":"AI output will be inserted above in new notebook cells","below-in-cells":"AI output will be inserted below in new notebook cells"};function w(e){const[t,o]=(0,d.useState)([]),[n,l]=(0,d.useState)(""),[r,a]=(0,d.useState)(),[i,c]=(0,d.useState)(!1);(0,d.useEffect)((()=>{!async function(){const e=await s.listTasks();if(o(e.tasks),!e.tasks.length)return void console.error("No tasks returned via the backend");const t=e.tasks[0].id;l(t);const n=await s.describeTask(t);a(n)}()}),[]);const v=(null==r?void 0:r.insertion_mode)&&r.insertion_mode in h?h[r.insertion_mode]:"";return u().createElement(p.Z,{theme:y()},u().createElement(m.Box,{padding:1,width:"40em"},u().createElement(m.Stack,{spacing:4},u().createElement(m.FormControl,{fullWidth:!0},u().createElement(m.InputLabel,{id:"prompt-type-select-label"},"Prompt type"),u().createElement(m.Select,{labelId:"prompt-type-select-label",id:"prompt-type-select",value:n,onChange:async e=>{l(e.target.value);const t=await s.describeTask(e.target.value);a(t)},label:"Prompt type",MenuProps:{style:{zIndex:2e4}},autoFocus:!0},t.map((e=>u().createElement(m.MenuItem,{key:e.id,value:e.id},e.name)))),u().createElement(m.Box,{pt:4,width:"40em"},u().createElement(m.Stack,{spacing:4},u().createElement(b,{label:"Prompt template",text:null==r?void 0:r.prompt_template}),v&&u().createElement(b,{label:"Task description",text:v}))),u().createElement(m.Stack,{direction:"row",justifyContent:"flex-end",spacing:1},u().createElement(m.Button,{variant:"outlined",onClick:e.closeDialog},"Cancel"),u().createElement(m.Button,{variant:"contained",onClick:async()=>{c(!0);try{const t={task_id:n,prompt_variables:{body:e.selectedText}},o=await s.sendPrompt(t);return f(e.app,{widget:e.editorWidget,request:t,response:o}),e.closeDialog(),!0}catch(e){return alert("**Failed** with error:\n```\n"+e.message+"\n```"),c(!1),!1}},disabled:!!i||""===n},i?"Submitting…":"Submit"))))))}var x=o(5510);class k extends x.Dialog{constructor(e){const t={...e.props,closeDialog:()=>{this.dispose()}};super({...e.body,body:x.ReactWidget.create(u().createElement(e.body,Object.assign({},t))),buttons:[]})}async open(){try{await super.launch()}catch(e){if(void 0!==e)throw e}}}function C(e){const t=E(e);if(!t)return"";const o=t.getSelection(),n=t.getOffsetAt(o.start),l=t.getOffsetAt(o.end);return t.model.sharedModel.getSource().substring(n,l)}function E(e){var t;let o;return e instanceof l.FileEditor?o=e.editor:e instanceof n.Notebook&&(o=null===(t=e.activeCell)||void 0===t?void 0:t.editor),o}function S(e,t){var o;const n=null===(o=e.model)||void 0===o?void 0:o.sharedModel.cells.findIndex((e=>e.getId()===t));return void 0===n?-1:n}function I(e,t){return async function(){var o;const l=null===(o=e.currentWidget)||void 0===o?void 0:o.content;if(!l)return console.error("Notebook is undefined."),!1;const r=l.activeCell;if(null===r)return console.error("Current cell is null."),!1;"raw"===r.model.type&&console.error("Current cell has invalid type `raw`.");const a="markdown"===r.model.type?M.GenerateCode:M.ExplainCode,i=r.model.sharedModel.getSource();console.log(`Calling ${a} command on source ${i}`);const c=function(e,t){const o=e.model,l=e.activeCellIndex;if(null===o)return"";"above-in-cells"===t?n.NotebookActions.insertAbove(e):n.NotebookActions.insertBelow(e);const r=e.activeCellIndex;n.NotebookActions.changeCellType(e,"markdown");const a=o.cells.get(r);return null==a||a.sharedModel.setSource("Analyzing your code …"),n.NotebookActions.runAndAdvance(e),e.activeCellIndex=l,a.id}(l,a===M.ExplainCode?"above-in-cells":"below-in-cells"),d={task_id:a,prompt_variables:{body:i}};let u;try{u=await s.sendPrompt(d)}catch(e){return function(e,t,o){var l,r;const a=S(e,t);-1!==a&&(e.activeCellIndex=a,n.NotebookActions.changeCellType(e,"markdown"),null===(r=null===(l=e.model)||void 0===l?void 0:l.cells.get(a))||void 0===r||r.sharedModel.setSource(o),n.NotebookActions.run(e))}(l,c,"**Failed** with error:\n```\n"+e.message+"\n```"),!1}finally{!function(e,t){var o;const n=S(e,t);-1!==n&&(null===(o=e.model)||void 0===o||o.sharedModel.deleteCell(n))}(l,c)}return f(t,{widget:l,request:d,response:u}),!0}}function A(e){return function(t){var o,n,l;const{widget:r,request:a,response:i}=t,c=E(r);if(!c)return!1;switch(e){case"above":null===(o=c.replaceSelection)||void 0===o||o.call(c,`${i.output}\n\n${a.prompt_variables.body}`);break;case"below":null===(n=c.replaceSelection)||void 0===n||n.call(c,`${a.prompt_variables.body}${i.output}`);break;case"replace":null===(l=c.replaceSelection)||void 0===l||l.call(c,i.output)}return!0}}function j(e){return function(t){var o;const{widget:l,response:r}=t;if(!(l instanceof n.Notebook))return console.error('Editor widget is not of type "Notebook".'),!1;const a=function(e){const t=[],o=e.split(/(```[a-z]*\n[\s\S]*?```)/g).map((e=>e.trim()));for(const e of o){let o="",n="markdown";e.startsWith("```")?(n="code",o=e.replace(/^```[a-z]*\n/,"").replace(/```$/,"").trim()):o=e.trim(),o.length>0&&t.push({cellType:n,source:o})}return t}(r.output);if(a.length<1)return console.error("No output cells."),!1;"above-in-cells"===e?n.NotebookActions.insertAbove(l):n.NotebookActions.insertBelow(l);for(let e=0;e<a.length;e++){const t=a[e];e>0&&n.NotebookActions.insertBelow(l),null===(o=l.activeCell)||void 0===o||o.model.sharedModel.setSource(t.source),n.NotebookActions.changeCellType(l,t.cellType),"markdown"===t.cellType&&n.NotebookActions.run(l)}return!0}}function N(e,t){return async function(){var o;const n=null===(o=e.currentWidget)||void 0===o?void 0:o.content;if(!n)return!1;const l=C(n);return new k({body:w,props:{selectedText:l,app:t,editorWidget:n}}).open(),!0}}const T=new(o(6591).LabIcon)({name:"jupyterlab-ai:psychology",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="css-10cscxr" focusable="false" aria-hidden="true" viewBox="0 0 24 24" data-testid="PsychologyIcon">\n    <path d="M13 8.57c-.79 0-1.43.64-1.43 1.43s.64 1.43 1.43 1.43 1.43-.64 1.43-1.43-.64-1.43-1.43-1.43z"></path><path d="M13 3C9.25 3 6.2 5.94 6.02 9.64L4.1 12.2c-.25.33-.01.8.4.8H6v3c0 1.1.9 2 2 2h1v3h7v-4.68c2.36-1.12 4-3.53 4-6.32 0-3.87-3.13-7-7-7zm3 7c0 .13-.01.26-.02.39l.83.66c.08.06.1.16.05.25l-.8 1.39c-.05.09-.16.12-.24.09l-.99-.4c-.21.16-.43.29-.67.39L14 13.83c-.01.1-.1.17-.2.17h-1.6c-.1 0-.18-.07-.2-.17l-.15-1.06c-.25-.1-.47-.23-.68-.39l-.99.4c-.09.03-.2 0-.25-.09l-.8-1.39c-.05-.08-.03-.19.05-.25l.84-.66c-.01-.13-.02-.26-.02-.39s.02-.27.04-.39l-.85-.66c-.08-.06-.1-.16-.05-.26l.8-1.38c.05-.09.15-.12.24-.09l1 .4c.2-.15.43-.29.67-.39L12 6.17c.02-.1.1-.17.2-.17h1.6c.1 0 .18.07.2.17l.15 1.06c.24.1.46.23.67.39l1-.4c.09-.03.2 0 .24.09l.8 1.38c.05.09.03.2-.05.26l-.85.66c.03.12.04.25.04.39z">\n    </path>\n</svg>'});var M,P;!function(e){e.GenerateCode="gpt3:generate-code-in-cells-below",e.ExplainCode="gpt3:explain-code-in-cells-above"}(M||(M={})),function(e){e.explainCodeCell="ai:explain-code-cell",e.codifyMdCell="ai:codify-md-cell",e.explainOrCodifyCell="ai:explain-or-codify-cell",e.generateFromNotebookSelection="ai:generate-from-notebook-selection",e.generateFromEditorSelection="ai:generate-from-editor-selection",e.insertAbove="ai:insert-above",e.insertBelow="ai:insert-below",e.insertReplace="ai:insert-replace",e.insertAboveInCells="ai:insert-above-in-cells",e.insertBelowInCells="ai:insert-below-in-cells"}(P||(P={}));const F={id:"jupyter_ai:plugin",autoStart:!0,requires:[n.INotebookTracker,l.IEditorTracker],activate:(e,t,o)=>{const{commands:n}=e;n.addCommand(P.generateFromNotebookSelection,{execute:N(t,e),label:"Generate output from selection with AI...",icon:T,isEnabled:()=>{var e;const o=null===(e=null==t?void 0:t.currentWidget)||void 0===e?void 0:e.content;return!(!o||!C(o))}}),n.addCommand(P.generateFromEditorSelection,{execute:N(o,e),label:"Generate output from selection with AI...",icon:T,isEnabled:()=>{var e;const t=null===(e=null==o?void 0:o.currentWidget)||void 0===e?void 0:e.content;return!(!t||!C(t))}}),n.addCommand(P.insertAbove,{execute:A("above")}),n.addCommand(P.insertBelow,{execute:A("below")}),n.addCommand(P.insertReplace,{execute:A("replace")}),n.addCommand(P.insertAboveInCells,{execute:j("above-in-cells")}),n.addCommand(P.insertBelowInCells,{execute:j("below-in-cells")}),n.addCommand(P.explainCodeCell,{execute:I(t,e),label:"Explain cell with AI",icon:T}),n.addCommand(P.codifyMdCell,{execute:I(t,e),label:"Codify cell with AI",icon:T}),n.addCommand(P.explainOrCodifyCell,{execute:I(t,e),label:"Explain or codify cell with AI",icon:T})}}}}]);