import codecs
import glob
import os
import shutil

extends = ["smali", "xml", "html"]
blacklist = ['.idea', '.git', 'build', 'lib', 'META-INF', 'original', 'apktool.yml']


def load_replace_keys(OO0O0OOOOOOOO0O00, OOO0O0OO0OO0O0OOO):
    O00O00OOOO00O0OO0 = "L" + OO0O0OOOOOOOO0O00.replace(".", "/")
    OO0OOOOOO0OO0O0OO = "L" + OOO0O0OO0OO0O0OOO.replace(".", "/")
    OOOOO0OOOOOOOO0O0 = [(OO0O0OOOOOOOO0O00, OOO0O0OO0OO0O0OOO), (O00O00OOOO00O0OO0, OO0OOOOOO0OO0O0OO)]
    print(OOOOO0OOOOOOOO0O0)
    return OOOOO0OOOOOOOO0O0


def execute_path(OO00OO00OO0O0OO0O, OOO0O000OOO0O0OOO, O0O0000OO00O0O00O, O0OO0OO000OO0000O):
    os.chdir(OO00OO00OO0O0OO0O)
    O000O0OO00O0O00OO = os.getcwd()
    OO000O0OOOOO0O0OO = os.listdir(O000O0OO00O0O00OO)
    for O0O000O0OO0O00O00 in OO000O0OOOOO0O0OO:
        if O0O000O0OO0O00O00 not in OOO0O000OOO0O0OOO:
            OO0O0OOOO000OO00O = os.path.join(O000O0OO00O0O00OO, O0O000O0OO0O00O00)
            if os.path.isfile(OO0O0OOOO000OO00O):
                print('fpath=', OO0O0OOOO000OO00O)
                if OO0O0OOOO000OO00O.split('.')[-1] in O0O0000OO00O0O00O:
                    with codecs.open(OO0O0OOOO000OO00O, "r", "utf-8") as OOOOOO0O0OO0O0O00:
                        OOOO00000O00OO00O = OOOOOO0O0OO0O0O00.read()
                    with codecs.open(OO0O0OOOO000OO00O, "w", "utf-8") as OOOOOO0OO0O0O0O00:
                        OO0000O0000O0OO0O = 0
                        for OO00OO0OOO0O0O0OO in O0OO0OO000OO0000O:
                            OO0000O0000O0OO0O += OOOO00000O00OO00O.count(OO00OO0OOO0O0O0OO[0])
                            OOOO00000O00OO00O = OOOO00000O00OO00O.replace(OO00OO0OOO0O0O0OO[0], OO00OO0OOO0O0O0OO[1])
                        print(r'替换次数：', OO0000O0000O0OO0O)
                        OOOOOO0OO0O0O0O00.write(OOOO00000O00OO00O)
            elif os.path.isdir(OO0O0OOOO000OO00O):
                execute_path(OO0O0OOOO000OO00O, blacklist, O0O0000OO00O0O00O, O0OO0OO000OO0000O)


def rename_directory(O00OOO0000OO0OO0O, O000000OOO0O0OO00, OO0OOO000OOOO00OO):
    O000000OOO0O0OO00 = O000000OOO0O0OO00.replace(".", "/")
    OO0OOO000OOOO00OO = OO0OOO000OOOO00OO.replace(".", "/")
    OOOO0OO0O0OO000OO = glob.glob(f"{O00OOO0000OO0OO0O}/**/com/{O000000OOO0O0OO00}/**")
    for O00OOOO0O0OO00000 in OOOO0OO0O0OO000OO:
        O000OOOOO0O0O0OO0 = O00OOOO0O0OO00000.split(O00OOO0000OO0OO0O)[1]
        OOOOOO0000000OO0O = O000OOOOO0O0O0OO0.replace(O000000OOO0O0OO00, OO0OOO000OOOO00OO)
        OOO0OOO00O00000OO = f"{O00OOO0000OO0OO0O}/{OOOOOO0000000OO0O}"
        OOO0O00OO000O0O0O = os.path.dirname(OOO0OOO00O00000OO)
        if not os.path.exists(OOO0O00OO000O0O0O):
            os.makedirs(OOO0O00OO000O0O0O, exist_ok=True)
        shutil.move(O00OOOO0O0OO00000, OOO0OOO00O00000OO)
    if O000000OOO0O0OO00 != OO0OOO000OOOO00OO:
        O000000OOO0O0OO00 = O000000OOO0O0OO00.split("/")[0]
        O0O0O00OOO0OO0000 = glob.glob(f"{O00OOO0000OO0OO0O}/**/com/{O000000OOO0O0OO00}")
        for O0OOO0OOO0OO000O0 in O0O0O00OOO0OO0000:
            removeDir(O0OOO0OOO0OO000O0)


def removeDir(O000O0000O00O0OOO):
    OOO00O0OO0OOO0000 = os.listdir(O000O0000O00O0OOO)
    for OOO0OOO00O00O0O0O in OOO00O0OO0OOO0000:
        O0O00OOOOOO0OO000 = os.path.join(O000O0000O00O0OOO, OOO0OOO00O00O0O0O)
        if os.path.isdir(O0O00OOOOOO0OO000):
            shutil.rmtree(O0O00OOOOOO0OO000, ignore_errors=True)
    os.rmdir(O000O0000O00O0OOO)


def getFolderName(O0O0OO0O000O00000):
    OO0OOOOO0O0O0OOO0 = O0O0OO0O000O00000.split(".")
    O000OOO0OO0OOOOO0 = OO0OOOOO0O0O0OOO0[-1]
    if len(OO0OOOOO0O0O0OOO0) > 2:
        O000OOO0OO0OOOOO0 = O0O0OO0O000O00000[len(OO0OOOOO0O0O0OOO0[0]) + 1:]
    return O000OOO0OO0OOOOO0


def replacePackage(O0OO00OOOOOOO000O):
    O0OOO0OOO000000OO = O0OO00OOOOOOO000O
    OOO0OOO0000OO00O0 = "com.whatsapp"
    OO000O0OOOOO00OO0 = "com.gbwhatsapp"
    O000OOO0OO000000O = load_replace_keys(OOO0OOO0000OO00O0, OO000O0OOOOO00OO0)
    execute_path(O0OOO0OOO000000OO, blacklist, extends, O000OOO0OO000000O)
    O00O0O0OOO0OOO000 = getFolderName(OOO0OOO0000OO00O0)
    OO000O0OOOOO00OO0 = getFolderName(OO000O0OOOOO00OO0)
    rename_directory(O0OOO0OOO000000OO, O00O0O0OOO0OOO000, OO000O0OOOOO00OO0)
